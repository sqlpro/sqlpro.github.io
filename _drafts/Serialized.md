---
title: 데이터 직렬화와 JSON, 프로토콜 버퍼
layout: post
date: '2020-08-04 19:27:23'
---

`직렬화` 는 **시리얼라이제이션(Serialization)**을 번역한 용어로, **데이터 구조나 객체의 상태를 다른 컴퓨터 환경에서 그대로 재구성할 수 있는 포맷으로 변환하는 과정**을 말한다. 조금 더 전문적으로 설명하자면, 메모리에 저장된 객체 데이터를 파일 저장 또는 전송에 적합한 형식으로 변환하는 과정이다. 대표적인 예로 **엑셀에서 작성한 결과물을 .xlsx 파일 형식으로 저장하는 경우**를 꼽을 수 있다(물론 이외에도 무수히 많다).

메모리 내의 원본 데이터 객체를 특정 포맷으로 변환하는 것을 **직렬화**, 직렬화된 데이터를 원본 데이터 객체로 되돌리는 것을 **역직렬화**라고 한다. 직렬화를 다른 말로 `객체를 마샬링한다`라고 표현하며, 그 반대는 `언마샬링한다`로 표현한다. 

모든 데이터를 직렬화해야 하는 것은 아니다. 일반 텍스트 파일은 데이터가 단순 나열되어 있기 때문에 이를 아스키 코드(ASCII Code)로 변환하여 저장하기만 하면 어느 컴퓨터 환경에서건 데이터를 다시 읽어들이는 데 문제가 없다. 이를 **플레인 텍스트(Plain Text, 평문 데이터)**라고 부른다. 플레인 텍스트는 그 자체로 이미 직렬화된 데이터이므로 다시 직렬화할 필요가 없다. 

하지만 많은 애플리케이션이 구조화된 데이터 형식을 사용한다. 저장하는 데이터 형식이 복잡하기 때문이다. 예를 들어 직렬화가 필요한 대표적인 프로그램인 엑셀(Excel)은 셀 내 데이터와 형식을 관리하기 위해 구조화된 데이터를 필요로 한다. 메타 정보가 중요하기 때문이다.  

엑셀은 대부분 셀 단위로 형식을 지정할 수 있는데, 여기에는 셀 스타일이나 너비, 높이, 데이터 포맷 등의 메타 정보가 모두 포함되어야 한다. 셀 자체의 위치 정보는 물론이거니와, 글자의 크기와 폰트도 필요하고 각 컬럼이 숫자 형식인지 통화 형식인지, 혹은 날짜 형식인지도 구분할 수 있어야 한다. 셀의 색상과 너비 역시 중요하다. 이런 정보를 원래의 데이터와 함께 저장하지 않으면 해당 파일을 다른 컴퓨터에서 열었을 때 셀 형식이 모두 초기화 되어버릴 것이다. 

![ ](/Users/prologue/Library/Application Support/typora-user-images/제목_없는_스프레드시트_-_Google_스프레드시트.png)

그래서 엑셀 프로그램은 구조화된 형식으로 셀 데이터를 관리한다. 예를 들면 위 그림의 (3, B) 셀 하나를 그대로 저장하기 위해서는 다음과 같은 데이터 구조를 정의해야 한다(물론 실제 데이터 구조와는 차이가 있으며, 하나의 데이터 구성 예시일 뿐이다). 

```yaml
- cellid: 98
  row : 3
  column: B
  format: date
  body: "2021-10-30"
  size: 
    width: 24px
    height: 20px
  style: 
    font: Verdana
    font-size: 9pt
    font-weight: normal
    font-italic: normal
    align: center
    background-color: DFDFDF
    border: 1px solid 000
```

실제로 데이터를 직렬화할 때에는 컬럼 명 등을 생략하고, 값과 값 사이에 최소한의 구분자만 넣는 식으로 단순화한다. 이를테면 cellid와 row와 column의 경우 `(98, 3, B)`로 변환하는 식이다. 

컬럼명은 생략되지만 구분자가 있으므로 순서만 지켜진다면 다시 읽어들이는 과정에도 문제는 없다. 맨 처음 값을 cellid로, 두번째 값을 row로 차례대로 할당하면 되기 때문이다. 덕분에 .xlsx로 저장된 파일을 다른 컴퓨터에서 엑셀 프로그램으로 읽어들이면 원래대로 복원된다. 

다만 역직렬화를 위해서는 직렬화 구조를 알아야 한다. 어떤 값이 어떤 순서로 저장되어 있는지를 파악할 수 있어야 역직렬화가 가능하다. 엑셀 파일을 일반 프로그램에서 열면 깨지는 것은 직렬화 구조를 파악할 수 없어 역직렬화가 불가능하기 때문이다. MS-Word용 .doc 파일과 한글용 .hwp 파일이 서로 호환되지 않는 것도 이와 같은 직렬화 문제에서 기인한다.  

## 이기종 시스템 간 통신에서의 직렬화 문제 

직렬화 문제는 앞에서 예로 든 일반 소프트웨어에서만 발생하는 것은 아니다. 서버 네트워크에서 이기종 시스템 간의 통신 상에서도 동일한 문제가 발생할 수 있다. 여기서 말하는 이기종 간이라는 것은 프로그래밍 언어의 차이를 의미한다. 

C로 구현된 시스템과 자바로 작성된 시스템 간에 데이터를 주고 받는다고 하자. 평문이라면 그냥 주고 받아도 상관없겠지만 다음과 같은 C 데이터는 자바 쪽으로 전달하기가 까다롭다. 직렬화하더라도 말이다. 

``` C 
typedef struct Person 
{
    char name[20];
    int age; 
    char* address; 
} Person 
```

가장 큰 문제는 데이터 타입에 있다. C의 구조체는 자바에서 지원하지 않는다. 프리미티브(Primitive) 타입에 대한 포인터 역시 마찬가지이다. 따라서 직렬화된 데이터의 구조를 알더라도 자바가 이를 역직렬화하여 복원할 수는 없다. 반대로 자바의 클래스 개념 또한 C에 존재하지 않기 때문에 자바 사이드에서 직렬화된 데이터를 C 사이드로 전달하는 것도 여의치 않다. 

따라서 C와 자바 시스템 간의 통신을 위해서는 이와 같은 직렬화 문제를 먼저 해결해야 한다. 

_(실제 이기종간 통신에는 직렬화 문제 외에도 바이트 오더(Byte Order) 같은 문제가 있지만 여기서는 핵심에 집중하기 위해 다른 문제는 고려하지 않는다)_





## SOAP와 REST API 

이기종 시스템간 통신에서의 직렬화 문제는 생각보다 간단한 방법으로 해결이 가능하다. 시스템이 달라서 데이터 교환에 손실이 발생한다면, 약간의 손실을 감수하고 양쪽 시스템 간에 모두 준수할 수 있도록 표준화된 데이터 포맷을 사용하여 직렬화/역직렬화 하는 방식이 바로 그것이다. 







